<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Theme Selector Debug - Bricks Attendance System</title>
    <link rel="stylesheet" href="css/styles.css">
    <style>
        .debug-content {
            margin-left: 280px;
            padding: 20px;
            font-family: monospace;
        }
        .debug-section {
            background: var(--bg-primary);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
        }
        .debug-output {
            background: var(--bg-secondary);
            padding: 10px;
            border-radius: 4px;
            white-space: pre-wrap;
            max-height: 200px;
            overflow-y: auto;
        }
        .test-button {
            background: var(--accent-primary);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
    </style>
</head>
<body>
    <!-- Sidebar will be generated by JavaScript -->
    <aside class="sidebar" id="sidebar">
        <div>Loading sidebar...</div>
    </aside>

    <div class="debug-content">
        <h1>Theme Selector Debug</h1>
        
        <div class="debug-section">
            <h3>üîç Theme Manager Status</h3>
            <div id="theme-manager-status" class="debug-output">Checking...</div>
            <button class="test-button" onclick="checkThemeManager()">Refresh Status</button>
        </div>

        <div class="debug-section">
            <h3>üé® Theme Selector Buttons</h3>
            <div id="theme-buttons-status" class="debug-output">Checking...</div>
            <button class="test-button" onclick="checkThemeButtons()">Check Buttons</button>
        </div>

        <div class="debug-section">
            <h3>üß™ Manual Theme Test</h3>
            <button class="test-button" onclick="testThemeLight()">Set Light Theme</button>
            <button class="test-button" onclick="testThemeDark()">Set Dark Theme</button>
            <div id="manual-test-output" class="debug-output"></div>
        </div>

        <div class="debug-section">
            <h3>üìù Console Log</h3>
            <div id="console-log" class="debug-output"></div>
            <button class="test-button" onclick="clearLog()">Clear Log</button>
        </div>
    </div>

    <!-- Load scripts in correct order -->
    <script src="js/mock-data.js" onerror="logError('Failed to load mock-data.js')"></script>
    <script src="js/data-service.js" onerror="logError('Failed to load data-service.js')"></script>
    <script src="js/auth.js" onerror="logError('Failed to load auth.js')"></script>
    <script src="js/theme.js" onerror="logError('Failed to load theme.js')"></script>
    <script src="js/sidebar.js" onerror="logError('Failed to load sidebar.js')"></script>

    <script>
        let consoleLog = [];

        // Override console.log to capture messages
        const originalConsoleLog = console.log;
        const originalConsoleWarn = console.warn;
        const originalConsoleError = console.error;

        console.log = function(...args) {
            consoleLog.push(`[LOG] ${args.join(' ')}`);
            updateConsoleDisplay();
            originalConsoleLog.apply(console, arguments);
        };

        console.warn = function(...args) {
            consoleLog.push(`[WARN] ${args.join(' ')}`);
            updateConsoleDisplay();
            originalConsoleWarn.apply(console, arguments);
        };

        console.error = function(...args) {
            consoleLog.push(`[ERROR] ${args.join(' ')}`);
            updateConsoleDisplay();
            originalConsoleError.apply(console, arguments);
        };

        function updateConsoleDisplay() {
            const logDiv = document.getElementById('console-log');
            logDiv.textContent = consoleLog.slice(-20).join('\n');
            logDiv.scrollTop = logDiv.scrollHeight;
        }

        function clearLog() {
            consoleLog = [];
            updateConsoleDisplay();
        }

        function logError(message) {
            console.error(message);
        }

        function checkThemeManager() {
            const status = document.getElementById('theme-manager-status');
            const info = {
                'window.setTheme': typeof window.setTheme,
                'window.themeManager': typeof window.themeManager,
                'window.toggleTheme': typeof window.toggleTheme,
                'window.getTheme': typeof window.getTheme,
                'current theme': document.documentElement.getAttribute('data-theme'),
                'body classes': document.body.className,
                'html data-theme': document.documentElement.getAttribute('data-theme')
            };
            
            status.textContent = JSON.stringify(info, null, 2);
        }

        function checkThemeButtons() {
            const status = document.getElementById('theme-buttons-status');
            const buttons = document.querySelectorAll('.theme-option');
            
            const info = {
                'buttons found': buttons.length,
                'buttons data': Array.from(buttons).map(btn => ({
                    'data-theme': btn.getAttribute('data-theme'),
                    'active': btn.classList.contains('active'),
                    'visible': btn.offsetParent !== null,
                    'clickable': !btn.disabled
                }))
            };
            
            status.textContent = JSON.stringify(info, null, 2);
        }

        function testThemeLight() {
            const output = document.getElementById('manual-test-output');
            output.textContent += `\nTesting light theme...`;
            
            if (typeof window.setTheme === 'function') {
                try {
                    window.setTheme('light');
                    output.textContent += `\n‚úÖ Light theme set successfully`;
                } catch (error) {
                    output.textContent += `\n‚ùå Error setting light theme: ${error.message}`;
                }
            } else {
                output.textContent += `\n‚ùå window.setTheme not available`;
            }
        }

        function testThemeDark() {
            const output = document.getElementById('manual-test-output');
            output.textContent += `\nTesting dark theme...`;
            
            if (typeof window.setTheme === 'function') {
                try {
                    window.setTheme('dark');
                    output.textContent += `\n‚úÖ Dark theme set successfully`;
                } catch (error) {
                    output.textContent += `\n‚ùå Error setting dark theme: ${error.message}`;
                }
            } else {
                output.textContent += `\n‚ùå window.setTheme not available`;
            }
        }

        // Auto-update status every 2 seconds
        setInterval(() => {
            checkThemeManager();
            checkThemeButtons();
        }, 2000);

        // Initial check when page loads
        window.addEventListener('load', () => {
            setTimeout(() => {
                checkThemeManager();
                checkThemeButtons();
                console.log('Debug page loaded and ready');
            }, 1000);
        });

        // Listen for theme changes
        document.addEventListener('themeChanged', (e) => {
            console.log('Theme change event detected:', e.detail);
        });

        // Monitor DOM changes to sidebar
        const sidebar = document.getElementById('sidebar');
        const observer = new MutationObserver((mutations) => {
            mutations.forEach((mutation) => {
                if (mutation.type === 'childList') {
                    console.log('Sidebar DOM changed');
                    setTimeout(checkThemeButtons, 100);
                }
            });
        });

        observer.observe(sidebar, { childList: true, subtree: true });
    </script>
</body>
</html>
