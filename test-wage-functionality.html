<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wage Functionality Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            background: #f9f9f9;
        }
        .test-result {
            padding: 10px;
            margin: 5px 0;
            border-radius: 3px;
        }
        .test-result.success { background: #d4edda; color: #155724; }
        .test-result.error { background: #f8d7da; color: #721c24; }
        .test-result.info { background: #d1ecf1; color: #0c5460; }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #0056b3;
        }
        pre {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 3px;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <h1>Employee Wage Functionality Test</h1>
    
    <div class="test-section">
        <h3>Test 1: Data Service API Methods</h3>
        <button onclick="testDataServiceMethods()">Test Data Service Methods</button>
        <div id="dataservice-results"></div>
    </div>

    <div class="test-section">
        <h3>Test 2: Currency Formatting</h3>
        <button onclick="testCurrencyFormatting()">Test Currency Formatting</button>
        <div id="currency-results"></div>
    </div>

    <div class="test-section">
        <h3>Test 3: Employee CRUD Operations</h3>
        <button onclick="testEmployeeCRUD()">Test Employee Operations</button>
        <div id="crud-results"></div>
    </div>

    <div class="test-section">
        <h3>Test 4: Wage Update Functionality</h3>
        <button onclick="testWageUpdate()">Test Wage Update</button>
        <div id="wage-results"></div>
    </div>

    <div class="test-section">
        <h3>Test 5: Payroll Calculation</h3>
        <button onclick="testPayrollCalculation()">Test Payroll Calculation</button>
        <div id="payroll-results"></div>
    </div>

    <!-- Include required scripts -->
    <script src="js/utils.js"></script>
    <script src="js/mock-data.js"></script>
    <script src="js/data-service.js"></script>

    <script>
        function logResult(containerId, message, type = 'info') {
            const container = document.getElementById(containerId);
            const resultDiv = document.createElement('div');
            resultDiv.className = `test-result ${type}`;
            resultDiv.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            container.appendChild(resultDiv);
            console.log(`[${type.toUpperCase()}] ${message}`);
        }

        function logData(containerId, data, label = 'Data') {
            const container = document.getElementById(containerId);
            const resultDiv = document.createElement('div');
            resultDiv.className = 'test-result info';
            resultDiv.innerHTML = `<strong>${label}:</strong><pre>${JSON.stringify(data, null, 2)}</pre>`;
            container.appendChild(resultDiv);
        }

        async function testDataServiceMethods() {
            const containerId = 'dataservice-results';
            document.getElementById(containerId).innerHTML = '';
            
            try {
                logResult(containerId, 'Testing data service initialization...', 'info');
                
                // Test if dataService is available
                if (typeof dataService === 'undefined') {
                    logResult(containerId, '❌ dataService is not defined', 'error');
                    return;
                }
                
                logResult(containerId, '✅ dataService is available', 'success');
                
                // Test required methods
                const requiredMethods = [
                    'getEmployees', 'getEmployee', 'updateEmployeeWage', 
                    'calculatePayroll', 'getOvertimeRequests', 'getPayrollHistory'
                ];
                
                for (const method of requiredMethods) {
                    if (typeof dataService[method] === 'function') {
                        logResult(containerId, `✅ ${method} method exists`, 'success');
                    } else {
                        logResult(containerId, `❌ ${method} method missing`, 'error');
                    }
                }
                
            } catch (error) {
                logResult(containerId, `❌ Error testing data service: ${error.message}`, 'error');
            }
        }

        async function testCurrencyFormatting() {
            const containerId = 'currency-results';
            document.getElementById(containerId).innerHTML = '';
            
            try {
                logResult(containerId, 'Testing currency formatting...', 'info');
                
                // Test if utils.formatCurrency is available
                if (typeof utils === 'undefined' || typeof utils.formatCurrency !== 'function') {
                    logResult(containerId, '❌ utils.formatCurrency is not available', 'error');
                    return;
                }
                
                const testAmounts = [0, 15.50, 1000, 12345.67];
                
                for (const amount of testAmounts) {
                    const formatted = utils.formatCurrency(amount);
                    logResult(containerId, `✅ ${amount} → ${formatted}`, 'success');
                }
                
            } catch (error) {
                logResult(containerId, `❌ Error testing currency formatting: ${error.message}`, 'error');
            }
        }

        async function testEmployeeCRUD() {
            const containerId = 'crud-results';
            document.getElementById(containerId).innerHTML = '';
            
            try {
                logResult(containerId, 'Testing employee CRUD operations...', 'info');
                
                // Test getting employees
                const employees = await dataService.getEmployees();
                logResult(containerId, `✅ Retrieved ${employees.length} employees`, 'success');
                
                if (employees.length > 0) {
                    const firstEmployee = employees[0];
                    logData(containerId, firstEmployee, 'First Employee');
                    
                    // Test getting single employee
                    const singleEmployee = await dataService.getEmployee(firstEmployee.id);
                    if (singleEmployee) {
                        logResult(containerId, `✅ Retrieved employee ${singleEmployee.firstName} ${singleEmployee.lastName}`, 'success');
                    } else {
                        logResult(containerId, '❌ Failed to retrieve single employee', 'error');
                    }
                }
                
            } catch (error) {
                logResult(containerId, `❌ Error testing employee CRUD: ${error.message}`, 'error');
            }
        }

        async function testWageUpdate() {
            const containerId = 'wage-results';
            document.getElementById(containerId).innerHTML = '';
            
            try {
                logResult(containerId, 'Testing wage update functionality...', 'info');
                
                const employees = await dataService.getEmployees();
                if (employees.length === 0) {
                    logResult(containerId, '❌ No employees found for testing', 'error');
                    return;
                }
                
                const testEmployee = employees[0];
                const originalRate = testEmployee.hourlyRate;
                const newRate = originalRate + 5; // Increase by ₱5
                
                logResult(containerId, `Testing with ${testEmployee.firstName} ${testEmployee.lastName}`, 'info');
                logResult(containerId, `Original rate: ₱${originalRate}/hr`, 'info');
                logResult(containerId, `New rate: ₱${newRate}/hr`, 'info');
                
                // Update the wage
                const updateResult = await dataService.updateEmployeeWage(testEmployee.id, newRate, 'Test wage increase');
                logResult(containerId, `✅ Wage update API call successful`, 'success');
                logData(containerId, updateResult, 'Update Result');
                
                // Verify the update
                const updatedEmployee = await dataService.getEmployee(testEmployee.id);
                if (updatedEmployee && Math.abs(updatedEmployee.hourlyRate - newRate) < 0.01) {
                    logResult(containerId, `✅ Wage update verified! New rate: ₱${updatedEmployee.hourlyRate}/hr`, 'success');
                } else {
                    logResult(containerId, `❌ Wage update failed. Expected: ₱${newRate}, Got: ₱${updatedEmployee?.hourlyRate || 'undefined'}`, 'error');
                }
                
            } catch (error) {
                logResult(containerId, `❌ Error testing wage update: ${error.message}`, 'error');
            }
        }

        async function testPayrollCalculation() {
            const containerId = 'payroll-results';
            document.getElementById(containerId).innerHTML = '';
            
            try {
                logResult(containerId, 'Testing payroll calculation...', 'info');
                
                const employees = await dataService.getEmployees();
                if (employees.length === 0) {
                    logResult(containerId, '❌ No employees found for testing', 'error');
                    return;
                }
                
                const testEmployee = employees[0];
                const startDate = '2025-07-01';
                const endDate = '2025-07-14';
                
                logResult(containerId, `Calculating payroll for ${testEmployee.firstName} ${testEmployee.lastName}`, 'info');
                logResult(containerId, `Period: ${startDate} to ${endDate}`, 'info');
                
                const payrollResult = await dataService.calculatePayroll(testEmployee.id, startDate, endDate);
                logResult(containerId, '✅ Payroll calculation successful', 'success');
                logData(containerId, payrollResult, 'Payroll Result');
                
                // Verify the calculation has required fields
                const requiredFields = ['grossPay', 'netPay', 'regularHours', 'overtimeHours', 'taxes'];
                for (const field of requiredFields) {
                    if (payrollResult.hasOwnProperty(field)) {
                        logResult(containerId, `✅ ${field}: ${payrollResult[field]}`, 'success');
                    } else {
                        logResult(containerId, `❌ Missing field: ${field}`, 'error');
                    }
                }
                
            } catch (error) {
                logResult(containerId, `❌ Error testing payroll calculation: ${error.message}`, 'error');
            }
        }

        // Run initial tests on page load
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Wage functionality test page loaded');
        });
    </script>
</body>
</html>
