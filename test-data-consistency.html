<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Data Consistency Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        h1, h2, h3 { color: #333; }
        .test-container { margin-bottom: 30px; border: 1px solid #ddd; padding: 15px; border-radius: 5px; }
        .success { color: green; }
        .error { color: red; }
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th, td { padding: 8px; text-align: left; border-bottom: 1px solid #ddd; }
        th { background-color: #f2f2f2; }
    </style>
</head>
<body>
    <h1>System Data Consistency Test</h1>
    <div class="test-container">
        <h2>Mock Data Structure Test</h2>
        <div id="mock-data-test"></div>
    </div>

    <div class="test-container">
        <h2>Employee Data Test</h2>
        <div id="employee-data-test"></div>
        <table id="employee-table">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Name (Role)</th>
                    <th>Department</th>
                    <th>Position</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>

    <div class="test-container">
        <h2>Dashboard Statistics Test</h2>
        <div id="dashboard-stats-test"></div>
    </div>

    <div class="test-container">
        <h2>Payroll Data Test</h2>
        <div id="payroll-data-test"></div>
    </div>

    <div class="test-container">
        <h2>Analytics Data Test</h2>
        <div id="analytics-data-test"></div>
    </div>

    <script src="js/mock-data.js"></script>
    <script src="js/data-service.js"></script>
    <script>
        // Initialize DataService
        const dataService = new DataService();

        // Test mock data structure
        function testMockData() {
            const output = document.getElementById('mock-data-test');
            
            if (!mockData || typeof mockData !== 'object') {
                output.innerHTML = '<p class="error">Error: mockData is not available or not an object</p>';
                return;
            }

            const usersCount = mockData.users ? mockData.users.length : 0;
            
            if (usersCount !== 6) {
                output.innerHTML = `<p class="error">Error: Expected 6 users, found ${usersCount}</p>`;
                return;
            }

            output.innerHTML = `
                <p class="success">Success: Mock data structure is valid</p>
                <p>Users count: ${usersCount}</p>
            `;
        }

        // Test employee data from dataService
        async function testEmployeeData() {
            const output = document.getElementById('employee-data-test');
            const tableBody = document.querySelector('#employee-table tbody');
            
            try {
                const employees = await dataService.getEmployees();
                
                if (!employees || !Array.isArray(employees)) {
                    output.innerHTML = '<p class="error">Error: getEmployees did not return an array</p>';
                    return;
                }

                if (employees.length !== 6) {
                    output.innerHTML = `<p class="error">Error: Expected 6 employees, found ${employees.length}</p>`;
                } else {
                    output.innerHTML = `<p class="success">Success: Found ${employees.length} employees</p>`;
                }

                // Display employees in table
                tableBody.innerHTML = '';
                employees.forEach(emp => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${emp.id}</td>
                        <td>${emp.firstName} ${emp.lastName} (${emp.role})</td>
                        <td>${emp.department}</td>
                        <td>${emp.position}</td>
                    `;
                    tableBody.appendChild(row);
                });
            } catch (error) {
                output.innerHTML = `<p class="error">Error fetching employee data: ${error.message}</p>`;
            }
        }

        // Test dashboard statistics
        async function testDashboardStats() {
            const output = document.getElementById('dashboard-stats-test');
            
            try {
                const stats = await dataService.getAttendanceStats();
                
                if (!stats || typeof stats !== 'object') {
                    output.innerHTML = '<p class="error">Error: getAttendanceStats did not return an object</p>';
                    return;
                }

                if (stats.totalEmployees !== 6) {
                    output.innerHTML = `<p class="error">Error: Expected totalEmployees to be 6, found ${stats.totalEmployees}</p>`;
                } else {
                    output.innerHTML = `
                        <p class="success">Success: Dashboard statistics are consistent</p>
                        <p>Total employees: ${stats.totalEmployees}</p>
                        <p>Present today: ${stats.presentToday}</p>
                        <p>Absent today: ${stats.absentToday}</p>
                        <p>Tardy today: ${stats.tardyToday}</p>
                    `;
                }
            } catch (error) {
                output.innerHTML = `<p class="error">Error fetching dashboard stats: ${error.message}</p>`;
            }
        }

        // Test payroll data
        async function testPayrollData() {
            const output = document.getElementById('payroll-data-test');
            
            try {
                // This is a simple check to verify that payroll calculations would be based on correct employee count
                const employees = await dataService.getEmployees();
                
                if (employees.length !== 6) {
                    output.innerHTML = `<p class="error">Error: Payroll would be calculated for ${employees.length} employees, expected 6</p>`;
                } else {
                    // Calculate total payroll for verification
                    const totalSalary = employees.reduce((sum, emp) => sum + (emp.salary || 0), 0);
                    const totalHourly = employees.reduce((sum, emp) => sum + (emp.hourlyRate || 0), 0);
                    
                    output.innerHTML = `
                        <p class="success">Success: Payroll data is based on 6 employees</p>
                        <p>Total employees for payroll: ${employees.length}</p>
                        <p>Total annual salary: $${totalSalary.toFixed(2)}</p>
                        <p>Sum of hourly rates: $${totalHourly.toFixed(2)}</p>
                    `;
                }
            } catch (error) {
                output.innerHTML = `<p class="error">Error checking payroll data: ${error.message}</p>`;
            }
        }

        // Test analytics data
        async function testAnalyticsData() {
            const output = document.getElementById('analytics-data-test');
            
            try {
                // Test the employee count used for analytics
                const stats = await dataService.getAttendanceStats();
                const employees = await dataService.getEmployees();
                
                if (stats.totalEmployees !== employees.length) {
                    output.innerHTML = `<p class="error">Error: Analytics uses ${stats.totalEmployees} employees, but employee list has ${employees.length}</p>`;
                } else {
                    output.innerHTML = `
                        <p class="success">Success: Analytics data is based on ${employees.length} employees</p>
                        <p>Total employees for analytics: ${employees.length}</p>
                        <p>Attendance rate: ${stats.attendanceRate}%</p>
                    `;
                }
            } catch (error) {
                output.innerHTML = `<p class="error">Error checking analytics data: ${error.message}</p>`;
            }
        }

        // Run all tests
        window.addEventListener('DOMContentLoaded', async () => {
            testMockData();
            await testEmployeeData();
            await testDashboardStats();
            await testPayrollData();
            await testAnalyticsData();
        });
    </script>
</body>
</html>
