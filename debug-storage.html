<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Local Storage Inspector</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .container { max-width: 1200px; margin: 0 auto; }
        .section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
        pre { background: #f5f5f5; padding: 10px; border-radius: 3px; overflow-x: auto; }
        button { padding: 10px 20px; margin: 5px; background: #007cba; color: white; border: none; border-radius: 3px; cursor: pointer; }
        button:hover { background: #005a87; }
        .data-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        .success { color: #4CAF50; }
        .error { color: #f44336; }
        .warning { color: #ff9800; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Local Storage Inspector & Data Service Tester</h1>
        
        <div class="section">
            <button onclick="inspectLocalStorage()">Inspect LocalStorage</button>
            <button onclick="clearBricksData()">Clear Bricks Data</button>
            <button onclick="createTestData()">Create Test Data</button>
            <button onclick="testDataServiceMethods()">Test Data Service Methods</button>
        </div>
        
        <div class="data-grid">
            <div class="section">
                <h3>LocalStorage Contents</h3>
                <div id="localStorage-content">Click "Inspect LocalStorage" to view contents</div>
            </div>
            
            <div class="section">
                <h3>Data Service Status</h3>
                <div id="dataService-status">Testing...</div>
            </div>
        </div>
        
        <div class="section">
            <h3>Test Results</h3>
            <div id="test-results"></div>
        </div>
    </div>

    <!-- Load data service scripts -->
    <script src="js/mock-data.js"></script>
    <script src="js/core/data-service-api.js"></script>
    <script src="js/core/local-storage-service.js"></script>
    <script src="js/core/api-service.js"></script>
    <script src="js/core/data-service-factory.js"></script>
    <script src="js/unified-data-service.js"></script>
    <script src="js/data-service.js"></script>

    <script>
        function log(message, type = 'info') {
            const resultsDiv = document.getElementById('test-results');
            const color = type === 'success' ? '#4CAF50' : type === 'error' ? '#f44336' : type === 'warning' ? '#ff9800' : '#333';
            resultsDiv.innerHTML += `<div style="color: ${color}; margin: 5px 0;">[${new Date().toLocaleTimeString()}] ${message}</div>`;
            console.log(message);
        }

        function inspectLocalStorage() {
            const content = document.getElementById('localStorage-content');
            const bricksKeys = [];
            
            for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                if (key.startsWith('bricks_')) {
                    bricksKeys.push(key);
                }
            }
            
            if (bricksKeys.length === 0) {
                content.innerHTML = '<em>No Bricks data found in localStorage</em>';
                return;
            }
            
            let html = '<h4>Bricks-related localStorage items:</h4>';
            bricksKeys.forEach(key => {
                const value = localStorage.getItem(key);
                let parsedValue;
                try {
                    parsedValue = JSON.parse(value);
                    html += `<h5>${key}:</h5><pre>${JSON.stringify(parsedValue, null, 2)}</pre>`;
                } catch (e) {
                    html += `<h5>${key}:</h5><pre>${value}</pre>`;
                }
            });
            
            content.innerHTML = html;
        }

        function clearBricksData() {
            const keys = [];
            for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                if (key.startsWith('bricks_')) {
                    keys.push(key);
                }
            }
            
            keys.forEach(key => localStorage.removeItem(key));
            log(`Cleared ${keys.length} Bricks data items from localStorage`, 'success');
            inspectLocalStorage();
        }

        async function createTestData() {
            try {
                if (!window.dataService) {
                    log('No data service found, creating one...', 'warning');
                    if (typeof LocalStorageDataService !== 'undefined') {
                        window.dataService = new LocalStorageDataService();
                        window.dataService.initialized = true;
                    } else {
                        log('LocalStorageDataService not available', 'error');
                        return;
                    }
                }

                log('Creating test data...', 'info');
                await window.dataService.createDefaultData();
                log('Test data created successfully!', 'success');
                
                setTimeout(inspectLocalStorage, 500);
            } catch (error) {
                log(`Error creating test data: ${error.message}`, 'error');
            }
        }

        async function testDataServiceMethods() {
            const statusDiv = document.getElementById('dataService-status');
            let html = '';
            
            if (!window.dataService) {
                html = '<span class="error">❌ Data service not available</span>';
                statusDiv.innerHTML = html;
                return;
            }
            
            html += `<div class="success">✅ Data service available (${window.dataService.constructor.name})</div>`;
            html += `<div>Initialized: ${window.dataService.initialized ? '✅' : '❌'}</div>`;
            
            // Test methods
            const methods = ['getEmployees', 'getAttendanceStats', 'getAttendanceRecords', 'getSettings'];
            
            for (const method of methods) {
                try {
                    if (typeof window.dataService[method] === 'function') {
                        let result;
                        if (method === 'getAttendanceRecords') {
                            result = await window.dataService[method]({});
                        } else {
                            result = await window.dataService[method]();
                        }
                        
                        html += `<div class="success">✅ ${method}: ${typeof result === 'object' ? JSON.stringify(result).substring(0, 100) + '...' : result}</div>`;
                        log(`${method} test passed`, 'success');
                    } else {
                        html += `<div class="error">❌ ${method}: method not found</div>`;
                        log(`${method} method not found`, 'error');
                    }
                } catch (error) {
                    html += `<div class="error">❌ ${method}: ${error.message}</div>`;
                    log(`${method} test failed: ${error.message}`, 'error');
                }
            }
            
            statusDiv.innerHTML = html;
        }

        // Auto-run initial checks
        window.addEventListener('load', function() {
            setTimeout(() => {
                inspectLocalStorage();
                testDataServiceMethods();
            }, 1000);
        });
    </script>
</body>
</html>
