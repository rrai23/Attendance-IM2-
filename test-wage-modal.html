<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Wage Modal - Bricks Attendance System</title>
    <link rel="stylesheet" href="/css/styles.css">
</head>
<body>
    <div class="container" style="padding: 2rem;">
        <h1>Test Wage Modal</h1>
        <p>Click the button below to test the wage editing modal functionality:</p>
        
        <button id="test-wage-btn" class="btn btn-primary">
            Test Wage Modal
        </button>

        <div id="test-results" style="margin-top: 2rem; padding: 1rem; background: #f5f5f5; border-radius: 8px; display: none;">
            <h3>Test Results:</h3>
            <div id="results-content"></div>
        </div>
    </div>

    <!-- JavaScript Dependencies -->
    <script src="/js/mock-data.js"></script>
    <script src="/js/data-service.js"></script>
    <script src="/js/modals.js"></script>
    <script src="/js/payroll.js"></script>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const testBtn = document.getElementById('test-wage-btn');
            const results = document.getElementById('test-results');
            const resultsContent = document.getElementById('results-content');

            // Show initial state
            setTimeout(() => {
                showResult(`modalManager available: ${typeof window.modalManager !== 'undefined' ? '✅' : '❌'}`, 
                         typeof window.modalManager !== 'undefined' ? 'success' : 'error');
                showResult(`PayrollController available: ${typeof window.PayrollController !== 'undefined' ? '✅' : '❌'}`, 
                         typeof window.PayrollController !== 'undefined' ? 'success' : 'error');
                showResult(`payrollController instance: ${typeof window.payrollController !== 'undefined' ? '✅' : '❌'}`, 
                         typeof window.payrollController !== 'undefined' ? 'success' : 'error');
            }, 1000);

            testBtn.addEventListener('click', function() {
                console.log('Testing wage modal...');
                
                // Clear previous results
                resultsContent.innerHTML = '';
                
                // Test if modalManager is available
                if (typeof window.modalManager === 'undefined') {
                    showResult('❌ modalManager is not available globally', 'error');
                    return;
                }

                showResult('✅ modalManager is available', 'success');

                // Test if PayrollController exists
                if (typeof window.PayrollController === 'undefined') {
                    showResult('❌ PayrollController class is not available', 'error');
                    return;
                }

                showResult('✅ PayrollController class is available', 'success');

                // Try to create instance or use existing one
                let payrollController;
                if (typeof window.payrollController !== 'undefined') {
                    payrollController = window.payrollController;
                    showResult('✅ Using existing payrollController instance', 'success');
                } else if (typeof window.createPayrollController === 'function') {
                    payrollController = window.createPayrollController();
                    if (payrollController) {
                        showResult('✅ Created PayrollController via factory function', 'success');
                    } else {
                        showResult('❌ Factory function failed to create instance', 'error');
                        return;
                    }
                } else {
                    try {
                        payrollController = new window.PayrollController();
                        window.payrollController = payrollController;
                        showResult('✅ Created new PayrollController instance manually', 'success');
                    } catch (error) {
                        showResult(`❌ Failed to create PayrollController: ${error.message}`, 'error');
                        return;
                    }
                }

                // Test the wage modal
                try {
                    // Mock employee data for testing
                    const mockEmployee = {
                        id: 'test-001',
                        firstName: 'John',
                        lastName: 'Doe',
                        hourlyRate: 15.50
                    };

                    // Add mock employee to the payroll controller
                    if (!payrollController.employees) {
                        payrollController.employees = [];
                    }
                    payrollController.employees.push(mockEmployee);

                    // Test if showEditWageModal method exists
                    if (typeof payrollController.showEditWageModal !== 'function') {
                        showResult('❌ showEditWageModal method not found', 'error');
                        return;
                    }

                    showResult('✅ showEditWageModal method available', 'success');

                    // Test the wage modal
                    payrollController.showEditWageModal('test-001');
                    
                    showResult('✅ Wage modal opened successfully', 'success');
                    
                } catch (error) {
                    showResult(`❌ Error testing wage modal: ${error.message}`, 'error');
                    console.error('Wage modal test error:', error);
                }
            });

            function showResult(message, type) {
                results.style.display = 'block';
                const resultDiv = document.createElement('div');
                resultDiv.style.color = type === 'success' ? 'green' : 'red';
                resultDiv.style.marginBottom = '0.5rem';
                resultDiv.style.fontFamily = 'monospace';
                resultDiv.textContent = message;
                resultsContent.appendChild(resultDiv);
            }

            console.log('Test page loaded.');
            console.log('modalManager available:', typeof window.modalManager !== 'undefined');
            console.log('PayrollController available:', typeof window.PayrollController !== 'undefined');
            console.log('payrollController instance:', typeof window.payrollController !== 'undefined');
        });
    </script>
</body>
</html>
