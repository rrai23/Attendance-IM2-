<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Final Action Buttons Test</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="css/styles.css">
    <style>
        .test-result {
            border: 1px solid #dee2e6;
            border-radius: 0.25rem;
            padding: 1rem;
            margin: 0.5rem 0;
            font-family: monospace;
            font-size: 0.9em;
        }
        .test-success { background-color: #d1ecf1; border-color: #bee5eb; }
        .test-error { background-color: #f8d7da; border-color: #f5c6cb; }
        .test-info { background-color: #e2e3e5; border-color: #d6d8db; }
    </style>
</head>
<body>
    <div class="container mt-4">
        <h1>Final Action Buttons Test</h1>
        <p>Comprehensive test of the fixed employee action button functionality.</p>
        
        <div class="row">
            <div class="col-md-8">
                <!-- Employee Table Section -->
                <div class="card">
                    <div class="card-header">
                        <h5>Employees</h5>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-striped">
                                <thead>
                                    <tr>
                                        <th>Employee</th>
                                        <th>Employee Code</th>
                                        <th>Department</th>
                                        <th>Position</th>
                                        <th>Email</th>
                                        <th>Status</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="employeesTableBody">
                                    <!-- Will be populated by EmployeesPageManager -->
                                </tbody>
                            </table>
                            <div id="emptyState" class="text-center py-4 hidden">
                                <p>No employees found.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="col-md-4">
                <!-- Test Results -->
                <div class="card">
                    <div class="card-header">
                        <h5>Test Results</h5>
                    </div>
                    <div class="card-body">
                        <div id="testResults" style="max-height: 500px; overflow-y: auto;"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Load all necessary scripts in correct order -->
    <script src="js/mock-data.js"></script>
    <script src="js/core/data-service-api.js"></script>
    <script src="js/core/local-storage-service.js"></script>
    <script src="js/core/api-service.js"></script>
    <script src="js/core/data-service-factory.js"></script>
    <script src="js/unified-data-service.js"></script>
    <script src="js/employees-page.js"></script>
    
    <script>
        // Mock the modal and error methods to capture results
        let testResults = [];
        
        function addTestResult(type, message) {
            const resultsDiv = document.getElementById('testResults');
            const result = document.createElement('div');
            result.className = `test-result test-${type}`;
            result.innerHTML = `<strong>${type.toUpperCase()}:</strong> ${message}`;
            resultsDiv.appendChild(result);
            resultsDiv.scrollTop = resultsDiv.scrollHeight;
            
            testResults.push({ type, message, timestamp: new Date() });
        }
        
        // Enhanced EmployeesPageManager for testing
        class TestEmployeesPageManager extends EmployeesPageManager {
            openModal(employee) {
                addTestResult('success', `EDIT modal opened for: ${employee.name || employee.fullName} (ID: ${employee.id})`);
                console.log('Edit modal opened for employee:', employee);
            }
            
            openViewModal(employee) {
                addTestResult('success', `VIEW modal opened for: ${employee.name || employee.fullName} (ID: ${employee.id})`);
                console.log('View modal opened for employee:', employee);
            }
            
            openDeleteModal(employee) {
                addTestResult('success', `DELETE modal opened for: ${employee.name || employee.fullName} (ID: ${employee.id})`);
                console.log('Delete modal opened for employee:', employee);
            }
            
            showError(message) {
                addTestResult('error', message);
                console.error('Error:', message);
            }
            
            showToast(message, type = 'info') {
                addTestResult(type, `Toast: ${message}`);
                console.log(`Toast (${type}):`, message);
            }
        }
        
        async function runTest() {
            try {
                addTestResult('info', 'Starting comprehensive action buttons test...');
                
                // Check and initialize data service
                addTestResult('info', 'Checking data service availability...');
                
                let dataService = null;
                if (window.dataService && window.dataService.initialized) {
                    addTestResult('success', 'Data service already initialized');
                    dataService = window.dataService;
                } else if (window.DataServiceFactory) {
                    addTestResult('info', 'Using DataServiceFactory to create service...');
                    dataService = window.DataServiceFactory.createBestService();
                    if (dataService.initialize) {
                        await dataService.initialize();
                    }
                    window.dataService = dataService;
                    addTestResult('success', 'Data service created and initialized');
                } else if (window.LocalStorageDataService) {
                    addTestResult('info', 'Using LocalStorageDataService directly...');
                    dataService = new window.LocalStorageDataService();
                    await dataService.initialize();
                    window.dataService = dataService;
                    addTestResult('success', 'LocalStorageDataService initialized');
                } else {
                    throw new Error('No data service implementation available');
                }
                
                // Initialize the test employees manager
                addTestResult('info', 'Initializing test employees manager...');
                const testManager = new TestEmployeesPageManager();
                await testManager.init();
                
                addTestResult('success', `Loaded ${testManager.employees.length} employees`);
                
                // Log employee data for debugging
                testManager.employees.forEach((emp, index) => {
                    addTestResult('info', `Employee ${index + 1}: ${emp.name || emp.fullName} (ID: ${emp.id}, type: ${typeof emp.id})`);
                });
                
                addTestResult('info', 'Click any action button above to test the functionality!');
                
                // Store reference for potential debugging
                window.testManager = testManager;
                
            } catch (error) {
                addTestResult('error', `Test initialization failed: ${error.message}`);
                console.error('Test error:', error);
            }
        }
        
        // Run test when page loads
        document.addEventListener('DOMContentLoaded', runTest);
    </script>
</body>
</html>
